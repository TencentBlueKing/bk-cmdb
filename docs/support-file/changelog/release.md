## [Version: 3.9.41] - 2022-06-21
**功能优化**
- 通过Excel导入数据时，对Excel表中的字段唯一标识进行校验

**缺陷修复**
- 修复通过Excel更新实例数据时，关联关系数据无法删除问题

## [Version: 3.9.40] - 2022-06-06
**缺陷修复**
- 修复事件监听偶现失败的问题

## [Version: 3.9.39] - 2022-03-16
**功能优化**
- 优化主机自动应用性能

## [Version: 3.9.38] - 2022-02-28
**新增功能**
- 新增交换模型属性分组位置的接口
- 新增根据主机id查询对应服务模版实例id的接口
- 导出excel时字段类型为枚举类型则为其添加一个sheet用于存放该枚举字段的选项
- 新增支持更新basereport老版本data id的到gse的接口
- 允许修改模型所属的模型分组

**功能优化**
- 平台管理增加业务快照名称修改表单项
- table类型的校验允许类型为interface或map数组
- 转移主机属性自动应用仅判断目标模块 
- 禁止创建bk打头的模型，用于后续创建内置模型
- 主机列表支持业务名筛选
- api task的迁移支持status为字符串的情况 
- 查询组织全名用于导出主机或实例时替换组织id
- 批量创建模型返回正确结果
- 业务空闲机与资源池解耦
- 主机转移时自动应用调整为按相同的更新数据进行批量更新
- 不允许用户创建bk开头的分组id
- 补充导入组织内容校验
- apiserver中新增metric采集项，统计无权限的访问量

**缺陷修复**
- 修复判断主线父节点忽略内置集群模块时对default进行强制类型转换导致panic的问题
- 修复批量编辑权限申请项目遗漏的问题
- 修复模型字段分组排序失效的问题
- 纠正平台管理中英版错误提示文样式不统一的问题
- 修复无法修改自定义模型字段分组名称的问题
- 修复克隆模板编辑更新时出现数据混乱的问题
- 修复在URL中修改业务ID时页面没有切换业务的问题
- 修复前端模型实例权限状态变更后未展示锁的问题
- 修复导入时获取excel内容逻辑
- 修复模板进程id参数类型错误
- 修复集群模板同步历史不展示集群名称和拓扑路径的问题
- 进程绑定信息中的IP统一为必填及调整保存进程信息接口入参
- 修复资源实例批量操作权限限制UI不准确的问题
- 修复模型实例属性修改后不成功的问题
- 修复用户拥有无限制业务权限，创建业务后查询资源池业务报错问题

## [Version: 3.9.37] - 2021-12-24
**新增功能**
- 首页多IP搜索支持逗号和分号分隔及返回时记住搜索内容
- 服务模板支持克隆
- 增加支持多个业务的空闲机模块中的主机转移到另外一个业务的空闲机模块

**功能优化**
- 移除平台管理字段校验规则配置模块
- 对业务拓扑树进行自然排序

**缺陷修复**
- 修复主机审计获取业务ID失败的问题
- 修复业务批量编辑全选控件错位问题
- 修复业务下属性分组更新时跨业务检验重名问题
- 修复主机属性自动应用拓扑树样式异常
- 修复批量修改业务属性需要点击两次才能修改的问题
- 修复服务模板实例同步状态加载报错的问题
- 修复获取服务模板同步状态权限解析失败的问题
- 修复导入主机判断excel表格数量问题
- 修复导入关联关系返回错误不正确问题
- 修复服务模板新建进程参数类型错误的问题

## [Version: 3.9.36] - 2021-12-07
**新增功能**
- 提供新接口给资源池的变更记录功能使用，鉴权方式与操作审计不同，根据用户是否有实例查看权限进行鉴权
- 新增平台管理模块

**功能优化**
- 事务写冲突时，在场景层进行有策略的重试操作，尽量避免写冲突
- 添加判断防止导入关联关系时获取对应单元格数据数组越界
- 跨业务转主机的业务选择列表支持按有权限的优先排序
- 增加转移主机时对业务是否归档的判断
- 编辑主机接口性能优化
- 页面转移主机接口调整为按主机最终模块聚合批量转移
- 主机自动应用仅更新有变化的主机
- 禁止内置集群模块通过接口修改
- attribute校验规则添加对table类型的逻辑
- 服务模板同步优化

**缺陷修复**
- 修复连接zk过程中出现服务注册失败导致服务不可用的问题
- 修复已归档业务小屏幕下操作按钮换行的样式问题

## [Version: 3.9.35] - 2021-11-22
**功能优化**
- 优化模型关系编辑拓扑按钮显示
- 优化后端内部查询业务通用接口请求参数
- 添加业务名输入联想组件在主机搜索业务名“包含”条件时使用
- 在更新服务实例标签的时候替换原有的create和delete接口为新的update接口
- 调整eventserver失败或无事件时等待时间为5秒

**缺陷修复**
- 修复业务内主机转移模块后端接口未创建服务实例的问题
- 修复创建业务成功后创建界面未关闭问题
- 解决跨域请求错误问题
- 修复查询业务下的主机和拓扑信息如果集群模块条件查询不到时返回全部的问题
- 修复服务实例标签编辑会失败的缺陷
- 修复主机搜索时因页码未重置导致无结果的问题
- 修复模型拓扑图“无位置节点”为空时报错导致交互异常问题
- 修复动态分组预览初始页码错误导致无法正确获取数据的问题

## [Version: 3.9.34] - 2021-10-22
**新增功能**
- 接口list_service_instance_detail新增支持传入多个hostId 
- 查询业务的接口支持批量传参

**功能优化**
- 移除v3.9.33版本中服务实例改造中包含的清理存量的无进程服务实例的逻辑
- 调整mongodb的连接池连接空闲超时时间为25分钟
- 主机转移模块限制单次批量转移数量为500
- 业务拓扑左侧树形菜单支持记住上次拉伸位置
- 修改彻底删除业务二次确认触发方式为点击
- 主机资源池表格复制功能优化
- 对诸如业务搜索等未对搜索字符做 trim 处理的进行处理补齐
- 调整apiserver的超时时间为25s

**缺陷修复**
- 修复组织选择器初始化未加载组织的问题
- 修复模型字段挪入新建分组时不生效的问题
- 修复新增主机未创建服务实现的问题 
- 修复批量跨页选择只有一页时也会展示跨页选择的问题

## [Version: 3.9.33] - 2021-10-11
**新增功能**
- 业务支持跨页批量编辑
- 归档业务提供“彻底删除”能力

**功能优化**
- 主机导出时，默认将业务、自定义层级、集群、模块各放一列导出， 方便用户对这3个模型进行筛选
- 导出实例数据时、通过并发获取用户数据，提高性能

**缺陷修复**
- 处理动态分组，字段类型为组织时的校验问题
- 主机数据导出时，如果没有自定义层级时，调整module、set数据的处理
- 修复查询主机删除历史bk_obj_id参数问题
- 修复模块中添加主机在有模板无进程创建服务实例时出错的问题
- 修复运营统计实例图表未显示问题
- 修复动态分组编辑和删除的鉴权，列表中只鉴权了第一个的问题
- 修复自关联模型拓扑数据展示不全的问题
- 修复模块中主机均无服务实例时无法转移到空闲机的问题
- 修复未正确获取进程数据导致无法克隆服务实例到其它主机的问题
- 主机搜索解决输入 \ 字符搜不到的问题

## [Version: 3.9.32] - 2021-09-13
**新增功能**
- 新增清理审计日志接口（接口使用方法可参考issue[#5603](https://github.com/Tencent/bk-cmdb/issues/5603)）

**功能优化**
- taskserver清除一个月之前的冗余任务
- 通用模型内置字段名称统一为不可修改
- 业务名搜索从大小写敏感改成大小写不敏感
- coreservice优化count逻辑
- 优化多值过滤项中IP项溢出隐藏文案展示
- 修复动态分组条件操作符未显示问题
- 修复获取topo节点主机数量接口缺陷
- 修复主机属性自动应用的逻辑失效问题
- 主机与服务实例解耦优化
- 主机和通用模型实例权限申请只显示无权限的实例
- 查询有权限的实例列表功能优化

**缺陷修复**
- 修复查看单个实例模型删除历史时加载了其他实例删除历史的问题
- 修复运营统计页面数据异常导致显示无权限的问题
- 修复集群模板同步状态会把同步人设置为当前用户的问题

## [Version: 3.9.31] - 2021-08-18
**功能优化**
- 主机字符字段支持模糊搜索
- 查询集群模板同步状态兼容集群下无模块的情况
- 业务名称搜索默认支持模糊搜索

**缺陷修复**
- 修复新建实例自关联的关联关系时对该实例获取两次锁导致失败的问题
- 修复使用主机/服务实例数量统计接口引起的topo创建问题
- 修复资源目录模型实例查询时，查询模式切换混乱的问题
- 修复模型关系新建层级时重复点击创建按钮仍然可以创建的问题
- 修复模型实例详情错误出现loading的问题

## [Version: 3.9.30] - 2021-08-06
**新增功能**
- list_biz_hosts接口新增支持按模块属性查询数据，list_biz_hosts_topo接口新增支持按集群、模块属性查数据
- 新增清除冗余task任务记录并设置定时清理机制
- 新增批量获取topo节点主机/服务实例数量的接口，业务拓扑节点主机/服务实例数量异步加载
- 服务模板绑定IP的校验规则放开，允许绑定IP为空
- 在主机类型枚举中增加Solaris类型

**功能优化**
- 获取实例数据时，前端没有传递排序字段时，默认使用实例ID进行排序
- 全部视图下将停用模型放置到同组的末尾
- 首页主机高级搜索跳转到资源主机全部列表页
- 放开首页主机搜索最大500条的限制，调整为10000。首页主机搜索IP与固资编号混合时可选择其中一种方式搜索
- 更新helm文档
- ip正则校验表达式增加对ip为0.0.0.0的校验
- 模型和主机自关联显示优化

**缺陷修复**
- 修复导出Excel时展示空用户名的问题
- 修复主机详情返回到业务拓扑主机列表条件保留问题
- 修复进程绑定信息校验和显示异常问题
- 修复查询拓扑数量接口在集群下没有模块的情况下传nil查询报错的问题
- 修复集群模板状态表查询逻辑
- 修复批量创建集群名称校验问题

## [Version: 3.9.29] - 2021-07-20
**新增功能**
- 各个模块新增version接口获取版本相关信息
- 前后端统一正则校验方式，统一用后端的正则校验方式进行校验。
- 首页主机搜索添加高级搜索入口跳转到资源主机高级筛选侧滑
- 集群模板拓扑树显示区域加loading
- 禁止主机转移至已经归档的业务


**功能优化**
- 优化进程模板与实例中进程绑定端口提示
- excel导出数据时，如果数据中的用户在用户管理中不存在时，导出中英文时保留原用户名并提示用户不存在、
- 上报的主机静态数据数据采用新协议时，直接更新主机数据不再校验时间窗口。
- 权限中心移除多余的关联权限(编辑服务实例、删除服务实例)
- 调整拓扑节点名称长度限制为256个字符


**缺陷修复**
- 修复模型关联列表id下划线未完整显示的问题
- 修复主机详情用户类型字段UI显示异常的问题
- 修复重命名云区域时可能出现更新失败的问题
- 修复日期面板偶现的被遮挡问题
- 修复复制主机集群名、模块名不完整的问题
- 修复主机属于多模块时，集群、模块相关字段显示不正确的问题
- 修复取消关联主线模型实例后取消关联失败的问题
- 修复实例关联列表错误的显示了实例自身的问题

**不兼容提示**
- 批量删除实例接口(batch_delete_inst)添加原来漏掉的鉴权功能，现补充上。加上鉴权后，可能不向下兼容，即原来无权限的用户现在不能正常调用该接口，需要平台和用户关注，如果确实需要删除权限，则直接删除该权限即可。
- 查询业务接口(search_business)接口，当业务不存在时，原来的策略是报错，现不报错，直接返回空。[PR:5473]

## [Version: 3.9.28] - 2021-07-01
**新增功能**
- 小工具增加对redis的操作支持
- 主机的自动发现信息属性字段调整为可编辑
- 服务模板实例标签加同步状态批示提示
- 模型管理页增加“全部”入口

**功能优化**
- 业务列表筛选组件切换为通用搜索组件
- 创建集群、模块时，对应模板列表按最后更新时间排序
- 主机自动应用的详情预览拉取数据改为异步加载，提升性能体验
- 主机自动应用的详情预览拉取接口内容瘦身，避免拉取冗余数据
- 新增服务实例，主机和拓扑关系表的2个索引
- 优化显示业务主机追加至业务模块菜单逻辑
- 优化集群模板同步性能，提升交互体验，同时去掉了集群模板及集群表中的version管理字段

**缺陷修复**
- 修复云账户编辑时连通测试通过无法保存的问题
- 修复非业务主机详情选项卡UI异常的问题
- 修复筛选主机并查看详情后返回筛选条件丢失的问题
- 修复创建拓扑自定义层级节点时出现ID字段的问题
- 修复部分场景下创建实例关联关系奶的问题，导致1:1,1:n的实例关联关系出现错误

## [Version: 3.9.27] - 2021-06-17
### 新增功能
- cmdb 主机模型内置属性【操作系统类型】增加 UNIX
- cmdb工具中增加对db的操作，目前支持查找，删除和显示指定db的所有collections
- 增加事件链路检查和升级gsecmdline命令

### 优化改进
- 模板/拓扑节点名称校验规则更新
- 查询服务模版同步状态的接口添加auth parser
- 动态分组支持主机的云区域字段
- 开放进程模板别名修改
- 调整通用模型实例表的es索引名
- UI: 去除业务拓扑服务实例表格的行吸顶效果
- UI: 主机属性不可编辑状态在自动应用的完善
- UI: 主机表格显示字段由切换显示筛选字段变更为追加显示
- UI: 修改业务拓扑移出菜单显示判断逻辑

### 缺陷修复
- 修复集群模板实例展示的问题
- UI: 修复操作审计详情未显示业务自定义字段的问题
- UI: 修复模型管理唯一标识不可见的问题
- UI: 修复操作审计入参错误的问题
- UI: 修复集群节点信息跳转链接失败的问题
- UI: 修复动态分组预览未显示完整表格的问题
- UI: 修复服务模板编辑后显示提示信息失败的问题

## [Version: 3.9.26] - 2021-06-03
### 新增功能
- 操作审计的 `账号` 字段现在支持 `in` 和 `not in` 两种查询条件（open_paas >= v2.12.17）

### 优化改进
- 对齐了服务模板和业务拓扑的命名规则，避免生成实例时因规则不同导致数据错误
- 改进主机移动模块的功能交互逻辑，增加 `追加` 和 `移出` 两个操作入口，满足对指定主机增量更新拓扑归属的需求
- 调整查询审计列表逻辑中对传参的判断逻辑，拆分新老参数判断方式
- 为了更好的提高兼容性和扩展能力，调整 ES 检索接口协议，优化入参和结果
- 现在当服务模板内有实例未更新同步时，在列表处会有 `小红点` 的提示了
- 为 `目标模型` 选择器添加了搜索的能力，优化因模型太多不好选中的体验
- 去除模型搜索结果没有匹配的分组显示，简化了搜索结果的体验
- 一些常规的 UI / UX 优化...

### 缺陷修复
- 修复在空闲机模块下转移主机到自身时，出现主机数 count 不准确的问题
- 解决全文检索的查询结果中命中了 `模型` 数据，但没有正常显示标签页的问题
- 解决业务自定义时间类型字段无法正常作用于动态分组的问题
- 解决批量编辑场景下，时间类型字段异常报错的问题

## [Version: 3.9.25] - 2021-05-14

**新增功能**
- 操作审计名称查询默认精确查找
- 主机搜索接口支持按时间搜索
- 主机/实例查询支持时间范围
- 模型实例长短字符支持精确/模糊搜索切换
- 新增apimachinery中2个metrics指标

**功能优化**
- 移除遗留的metadata兼容逻辑
- 对模型字段正则校验文本进行前置校验
- 拓扑缓存管理支持按ID进行排序管理，并去重。
- 前端打包构建升级

**缺陷修复**
- 升级click-outside指令，解决服务分类/资源目录无法操作的问题
- 修复长短字符搜索组件无法粘贴的问题
- 修复集群被删除后， 集群同步表数据还存在，依然展示在集群模板实例中展示
- 修复集群同步表中没有集群同步市局的时候，在集群模板实例中不显示
- 修复es检索不到通用模型实例的问题
- 修复主机自定义显示列加载时不显示模块名/集群名的问题
- 修复模型管理实例字段字段排序设置组件未正确渲染的问题
- 修复主机筛选部分组件输入框被操作按钮遮挡的问题
- 修复删除事务在部分场景下无法正常入库的问题 

## [Version: 3.9.24] - 2021-04-23
**新增功能**
- 支持通过bk_obj_id查询实例关联的操作审计
- 查询实例接口支持按时间查询

**功能优化**
- UI: 对接前端代码规范
- 添加主机模型的“CPU架构”字段之前校验它所在的属性分组是否存在
- 更新模型实例的校验的忽略字段仅对包括主线模型的内置模型生效
- 主机快照采集改为ip与mac地址一一对应，如果ip没有对应的mac则置空
- 开放不同自定义层级下集群同名限制
- 优化普通模型实例查询交互
- 优化操作审计loading效果

**缺陷修复**
- 修复导入实例报错信息不正确问题
- 修复获取拓扑路径接口使用metadata查询自定义层级实例的问题
- 修复es全文检索不到含_或.字符的问题，并能够检索到含有([等特殊字符的内容
- 修复导出用户类型字段顺序与录入顺序不同的问题
- 修复新增模型字段分组索引不正确的问题
- 修复全文检索显示实例模型名称为undefined的问题

## [Version: 3.9.23] - 2021-04-08
**新增功能**
- 服务模板同步对比接口支持返回上service_template_id值
- 主机快照采集支持mac地址去重功能

**功能优化**
- 时间类型字段兼容带时区的格式
- 优化批量更新主机接口的鉴权性能
- 实例时间字段格式化，避免提交UTC格式

**缺陷修复**
- 修复创建默认服务分类所在的upgrader失败时重复创建多个服务分类的问题
- 属性自动应用启停判断修正
- 修复在zk连接失败的情况下多次重连产生多个连接的问题
- 修复导入模型异常问题

## [Version: 3.9.22] - 2021-04-01
**新增功能**
- 主机静态数据采集支持在多IP的情况下获取各IP对应的mac地址
- 主机模型新增"CPU架构"字段
- 业务拓扑模块节点信息添加属性自动应用标识
- 业务导航权限列表静默刷新
- 查询服务模版差异接口支持部分比较而提前返回差异结果
- 支持进程实例watch功能
- 查询接口支持左高右低优先级的多字段排序功能
- list_process_related_info点分五位查询进程的接口支持按进程属性筛选查询功能
- 新增支持权限中心常用分组：业务运维，主机资源管理员，开发者，模型关系维护人，审计员。
- 新增根据自定义层级实例信息查询主机所属的关系接口find_host_relations_with_topo。
- 新增根据主机的信息，构建查询条件，查询主机详情与其所属拓扑的信息接口list_host_detail_topology。
- 新增支持contain,exist,not_exists查询操作符，其中contain操作符为正则查询，且大小写不敏感。
- 添加注册主机静态快照采集的dataid的接口，支持dataid的新增、更新、和删除功能。
>  * API： POST http://{adminserver的地址}/migrate/v3/migrate/dataid，不需要传body
>  * gse dataid管理接口功能依赖gse版本>=v1.7.6

> 新增功能API版本依赖：
> esb open_paas版本 >= 2.12.10


**功能优化**
- 调整查询内置模块的方式，不带模块名
- 优化事件watch中，主从切换时重新watch的逻辑
- UI优化动态分组查询对象选择器
- 主机IP等特殊字段转换为数组时如果为空则值置为nil，非空则去除前后空格和逗号。(注：该调整会删新现有主机表中的主机IP等字段数据，会走升级流程)
- 事件监听忽略context cancelled错误
- 调整进程实例数据升级时，针对未绑定IP的进程升级策略，若已经绑定IP，则跳过，未绑定则执行升级流程。[PR:5153]
- adminserver的mongodb、redis和common配置从相应配置文件读取

**缺陷修复**
- 粘性布局闪烁的问题
- 部分字段预览失败的问题

## [Version: 3.9.21] - 2021-03-22
**功能优化**
- 优化动态分组查询对象选择器
- 进程模板新增绑定信息，同步时使用默认值新增进程中的绑定信息
- 调整事件服务监听逻辑，由同步调整为异步，加快启动速度。
- v3.2升级到v3.9进程有空bind_ip时使用默认值127.0.0.1

**缺陷修复**
- 修复导出模型失败的问题
- 修复zk节点丢失后不能重新注册的问题

## [Version: 3.9.20] - 2021-03-08
**新增功能**
- 进程模板新增绑定信息，同步时使用默认值新增进程中的绑定信息

**缺陷修复**
- 修复zk节点丢失后不能重新注册的问题
- 修复初始化事件表的时候StartAtTime为空时panic的问题 

## [Version: 3.9.19] - 2021-03-04
**新增功能**
- 查询服务模版列表接口支持按模版名称精确或模糊匹配查找
- 支持新版的主机静态数据采集功能与协议，依赖监控新版采集插件(bkmonitorbeat)上报数据

**功能优化**
- 主机实时状态功能前端展示页面下线，主机模型及实例中的bk_cpu_mhz字段会删除。（注：如果主机数量较多，此版本的执行migrate脚本升级时间可能会略长）

**缺陷修复**
- 修复业务自定义层级校验异常问题
- 修复实例详情变更记录搜索为空时显示错误的问题

## [Version: 3.9.18] - 2021-03-02
**新增功能**
- 业务主机按模块名、集群名过滤添加自动补全功能
- 动态分组集群、模块名筛选支持自动补全

**功能优化**
- 优化业务拓扑主机菜单的归类
- 操作审计新增appcode与request id字段
- 实例关联表和进程模版表增加索引（增加索引过程中出现的问题，处理方式可参考 issue [#5072](https://github.com/Tencent/bk-cmdb/issues/5072)）
- 主线模型实例创建更新时，对bk_parent_id字段进行校验
- 允许主机导出'录入方式'和'录入时间'字段
- 主机更新时允许更新绑定了自动应用的字段
- 调整查询业务无权限错误返回
- 第一次watch如果有例如token过期的错误则不用token拉取事件
- watch失败时返回真实错误码而非-1
- 点分五位获取进程实例信息接口支持按进程字段排序
- 调整object接口的路由匹配方式
- 无权限返回内容里增加操作ID、资源类型ID、实例ID对应的名称

**缺陷修复**
- 修复不带fields监听事件时查询删除事件详情失败的问题
- 修复主机转移到带模版的模块下重复创建进程实例的问题
- 修复实例删除历史为空时页面显示错误的问题
- 修复离开页面确认在部分情况下会重复提示的问题
- 修复当主机有关联主线模型实例时，导出主机失败的问题
- 修复进程编辑后报唯一校验失败而无法保存的问题

## [Version: 3.9.17] - 2021-02-02
**新增功能**
- 添加根据实例名模糊查询模型实例名称列表的接口
- 服务实例进程模板允许设置非锁定的默认值
- 主机属性克隆支持用主机ID克隆
- 添加校验业务字段的hook
- 新增记录长时间请求的日志记录功能
- 主机静态快照数据支持新的静态数据上报协议

**功能优化**
- 清除topolatest里有替换接口的旧接口
- 优化申请权限关联资源显示为资源名称
- 无权限样式UI和交互统一优化
- 初始化进程时，所有字段均使用模板的默认值
- 进程的非锁定字段可以修改，锁定字段不可修改
- 模板校验绑定IP、端口、协议必填
- 主机快速筛选支持搜索多个
- 人员选择器支持配置快速选择自己
- 事件不需要重试时将retryCount归零
- 优化查询服务模版和服务实例差异的接口
- 优化同步服务模版和服务实例差异的接口
- 优化统计业务总数、主机总数的接口
- 优化根据模型字段分组计数的接口
- 优化事件订阅的日志输出
- 优化业务下创建自定义字段唯一标识重名时的错误返回提示
- 优化创建同名集群时的错误返回提示
- 调整主机快照更新逻辑，只更新有效数据
- 创建服务实例接口性能优化
- 去掉禁用事务的flag和相关代码逻辑

**缺陷修复**
- 修复主机列表存在多业务拓扑时渲染错误的问题
- 修复统计各业务下主机数量不对的问题
- 修复主机id_list缓存刷新失败的问题
- 修复批量更新带有部分联合唯一键字段时失败的问题
- 修复ES全文检索MAC地址这种带有':'等特殊符号报错的问题

## [Version: 3.9.16] - 2021-01-11
**功能优化**
- 主机搜索字符类型支持粘贴
- 优化大批量导入主机逻辑
- 导出选择字段全选修改为按分组全选
- 主机选择器中已选主机添加重复标签
- 操作审计所属模型查询条件不显示无模型的分组
- 服务分类标题样式等其它优化项
- 接口clone_host_property功能调整，去掉其中转移主机的逻辑，仅允许拷贝可编辑且属于唯一校验规则的字段。`形态调整，该接口不兼容原有逻辑`。

**缺陷修复**
- 修复在excel导入编辑少量主机字段时，没有忽略业务拓扑、业务名、云区域等字段值为'--'而导致报错的问题
- 修复业务拓扑下跨业务转主机错误
- 修复首页云区域混合搜索判断错误的问题
- 修复服务分类模板分类筛选错误的问题
- 修复资源池业务拓扑复制数据为空的问题
- 修复转移主机目录可重复点击的问题
- 修复模板模块新增服务实例第一内外网IP设置不正确的问题
- 修复主机云区域更新校验传值顺序错误的问题
- 修复查询上一次最后的事件的条件错误的问题

## [Version: 3.9.15] - 2021-01-06
**新增功能**
- 单个主机支持修改业务拓扑
- 将主机导出excel中的用户名从英文修改为中英文
- excel导入主机分成导入新增和导入更新两个接口
- excel导入新增主机支持导入到资源池自定义目录
- excel导出主机支持大批量导出
- 增加异常数据监控采集上报组件
- 添加校验禁止用通用模型实例接口查询biz, module, set, host, plat, process

**功能优化**
- 事件功能优化 (新增mongodb database需求，需要新的db，默认为cmdb_event)
- 移除find_host_by_module接口
- 保持excel导入的错误提示信息行数有序
- 删除实例操作性能优化
- 转移主机新增服务实例默认折叠
- 主机无快照提示及跳转链接优化
- 优化空闲机池模块排序
- 转移主机预览减少非必要渲染
- 添加判断主机云区域更新操作是否合法的hook
- 去掉excel导出字段业务拓扑里的业务级别
- 去掉下载主机excel模版里云区域字段
- excel导出的云区域ID字段标注为'-'
- 优化模型实例的创建和更新操作
- 优化zk重连操作
- 优化请求资源失败提示
- 优化登录链接构造方法
- 主机筛选条件字段不显示业务拓扑
- 服务模板删除进程显示同步实例提示
- 集群模板编辑时添加模板支持全选和不显示列表中的编辑按钮
- 服务模板列表不显示编辑按钮

**缺陷修复**
- 修复主机表格显示字段数据获取错误的问题
- 修复清空zk上的限流规则后没有被同步的问题
- 修复zk上的cc配置没有持续被watch的问题

## [Version: 3.9.14] - 2020-12-14
**新增功能**
- 增加刷新配置的shell工具脚本
- 主机归还资源池选择指定目录归还
- 主机导出支持选择字段
- 从业务归还主机到主机池，支持选择目标目录
- 为mongodb、rest response增加metrics

**功能优化**
- 主机池全部tab允许分配非业务主机
- 优化分配到其他业务加载时的loading效果
- 集群模板编辑拓扑交互优化
- 进程表格绑定信息列tooltip显示优化
- 服务模板交互细节优化
- 集群模板编辑创建成功提示文案和按钮跳转优化
- 主机详情业务拓扑链接跳转优化
- 将coreservice中的主机快照数据接口迁移到cacheservice
- 优化前端鉴权性能
- 导出主机可选字段不显示ID和业务拓扑
- 清除自定义层级实例的default字段
- 主机详情拓扑展示优化（添加单双列切换提示和单个拓扑值时始终保持铺满显示）
- 导出主机可选字段去掉云区域和内网IP
- 主机详情服务列表中支持对服务实例名称的编辑
- 增加补全自定义层级模型实例bk_biz_id字段的升级程序
- 优化集群模板对比和同步接口
- 调整进程属性字段的展示顺序
- 将启动等待时长的最小值设为0
- 将升级程序里的删除实例关系的updatgeflag字段改成分页删除，防止实例数据过多时DB io timeout
- 主机筛选IP校验由实时校验改为失焦校验
- 禁止通过toposerver创建内置字段
- 优化/topo/internal/{owner}/{bk_biz_id}/with_statistics接口
- 将查询进程的具体操作从service拆出到logics
- 进程模板和进程信息中的绑定信息允许没有任何数据

**缺陷修复**
- 解决业务拓扑及服务模板重复点击提交问题
- 修复存在多个开发商的资源池时authserver查询到错误的资源池ID的问题
- 修复服务模板字段在表格列表中未正确显示的问题
- 修复主机表格配置在无筛选项时不生效的问题
- 修复集群模板编辑时错误的权限配置
- 修复业务、通用模型实例表格配置属性不显示的问题
- 修复动态分组对人员类型字段旧数据展示未兼容的问题
- 修复不能按服务模版名查找筛选服务模版列表的问题

## [Version: 3.9.13] - 2020-11-25
**新增功能**
- 主机增加快速搜索功能
- 首页支持“云区域id:ip"格式搜索
- 主机支持"云区域id:ip"格式筛选
- 主机支持批量复制"云区域id:ip"格式
- 主机导出功能支持选择字段
- 新增点分五位查询进程实例的相关信息接口
- 增加查询业务topo树简要信息的接口
- 增加批量查询服务模版计数信息的接口
- 服务实例创建时可自定义名称
- 服务分类列表页中显示一级分类ID
    
**功能优化**
- 主机高级筛选功能交互优化
- 主机条件收藏功能交互优化
- 审计查询接口的时间字段调整为必填字段
- 服务模板列表数量同步查询变更为异步查询
- 进程服务模版列表接口支持只传进程模版id数组批量获取进程模版详情
- 运营统计后台停止统计数据时，显示提示信息
- 新加修改进程bind info相关升级
- 清除docker_server_version和docker_client_version相关逻辑
- 业务拓扑跳转到集群模板由编辑页改为查看页
- 业务拓扑选择空集群节点时显示创建模块提示
- 清除bk_childid和bk_parentid字段和相关逻辑
- 移除进程和进程模版的"拉起间隔"、"功能ID"属性， 进程增加"启动等待时长"属性
- 删除进程实例和进程模版实例的auto_time_gap和bk_func_id字段

**缺陷修复**
- 修复获取拓扑节点路径的接口在集群的上一级为业务的时候不设置集群名字的问题
- 修复属性分组唯一索引设置错误的问题
- 修复导入主机时候，自定义字段无法导出的问题

## [Version: 3.9.12] - 2020-11-17
**新增功能**
- 添加设置进程VIP的hook
- 新增事件flow watch的metrics采集
- 下线动态分组相关的老接口：
    * create_custom_query
    * get_custom_query_data
    * search_custom_query
    * get_custom_query_detail
    * update_custom_query
    * delete_custom_query

**功能优化**
- 权限中心拉取资源与mongodb读优化
- 在主机的导出excel中增加"业务"栏,并更改相关cell外观
- 模型字段增加显示id和支持搜索
- 操作审计查询模型实例时增加所属模型条件
- 拓扑节点信息节点ID作为独立属性显示
- 服务分类支持ID搜索和显示优化
- 添加校验业务的hook和模型唯一校验的hook

**缺陷修复**
- 修复服务模版同步pid文件路径、启动优先级信息失败的问题

## [Version: 3.9.11] - 2020-11-11
**新增功能**
- 增加更新服务实例的接口

**功能优化**
- list_biz_hosts接口返回数据为空时，返回值为空数组
- 操作审计允许根据bk_obj_id查询
- 运营统计优化
- 去掉操作进程或服务实例所触发的自动更新服务实例名称逻辑

**缺陷修复**
- 修复多开发商情况下一个业务会有多个相同的自定义字段的问题

## [Version: 3.9.10] - 2020-11-05
**功能优化**
- 优化当事件resume token失效时，重新watch
- 优化主机池文案
- 优化右上角文档链接
- 去除创建蓝鲸业务拓扑除空闲机池之外的节点的操作
- 调整主机唯一校验规则
- 操作审计默认查询时间为当天

**缺陷修复**
- 修复权限中心主机回调接口主机查询分页失败的问题
- 修复转移主机到直接新建的模块下时，会新增两个重复服务实例的问题
- 修复跨业务转移主机无权限操作时不显示权限窗口的问题
- 修复模块新增主机时手动输入ip不同云区域下相同IP仅录入一条数据的问题

## [Version: 3.9.9] - 2020-11-02
**Note**
该版本中新增了添加唯一索引的upgrader，若migrate脚本执行失败，需要处理完数据，确保数据正确后，再参考
如下链接重新执行该upgrader，直到migrate能正常执行。
链接：https://github.com/Tencent/bk-cmdb/issues/4757

**新增功能**
- 操作系统类型设置为可编辑
- 增加帮助文档地址配置
- 业务主机详情支持编辑服务实例进程
- 主机详情拓扑支持切换单列/双列显示
- 主机详情拓扑支持跳转新页面
- title配置根据版本进行初始化
- 升级程序增加cc_HostLock表
- 新增配置发现功能在adminserver侧做参数校验
- 新加所有表的唯一索引upgrader
- metrics 添加 appcode 字段

**功能优化**
- 主机转移使用批量操作
- 优化事件gc逻辑
- 子页面无操作路径记录场景下默认可回退至关联导航页
- 优化服务注册的逻辑，在http服务listen后，再注册服务
- 负载均衡策略优化
- UI使用新版主机选择器
- 服务分类显示ID
- 服务分类加搜索和添加二级分类交互优化
- apiserver中鉴权的body性能优化
- 修改间隔时间窗口为整时开启
- 支持根据操作审计id批量查询审计详情
- 动态分组表单兼容旧数据的显示
- 优化事件监听接口在异常场景下的处理逻辑, 挂起500ms后返回

**缺陷修复**
- 修复时间类型错误
- 云同步的写操作使用相应环境的开发商 ,修复云同步任务历史记录以及云主机查询不到的问题
- 修复flow watch内存泄漏的问题
- 修复3.2有存量主机数据时因为ip字段不匹配导致数据升级失败的问题
- 事件监听保留最后一个事件，修复所有事件均超时后使用cursor监听失败的问题
- 修复reflect.TypeOf()未判断结果是否为nil导致后续调用函数panic的问题
- 修复当配置redis前置中关于redis的配置不是第一个InitClient的时候无法连接导对应redis的问题

## [Version: 3.9.8] - 2020-10-21
**新增功能**
- 支持跨业务转移主机，在不同业务的空闲机池间转移
- 新增执行指定migrate版本的升级程序
- 增加查询实例所有关联的接口(将实例视为关联源模型和关联目标模型)
- 动态分组查询条件模块属性支持服务模板筛选
- 升级redis driver为go-redis
- 支持sentinel加密配置
- datacollection添加时间窗口功能
- 增加获取各云区域下主机数量的接口
- coreservice增加获取mongo任意表字段dintinct值的通用接口

**功能优化**
- 将webserver的404错误重定向到定制的404页面
- 对eventServer使用kit方式接入服务
- 主机更新创建时对bk_cloud_id做校验，必须为数值型
- 优化从URL中匹配bizID的方式,使其匹配更精准
- 业务拓扑表格字段显示仅固定ID/IP/云区域字段
- DAL层创建索引时忽略索引已存在的错误，后续创建索引时无需判断索引是否存在
- 动态分组数据迁移规则更新
- 为缺少bk_biz_id字段的公共属性增加bk_biz_id字段且值为0
- search_inst_by_object 和 get_biz_internal_module 接口优化，去除查询模型的操作
- 优化ListProcessInstancesNameIDsInModule接口

**缺陷修复**
- 修复因supplierID不同导致云资源同步不成功的问题
- 修复动态分组范围类的查询条件编辑时表单渲染错误的问题
- 修复云资源发现新建任务账号禁用提示语错位的问题
- 修复动态分组选择属性筛选功能无效的问题
- 模型管理跳转主机资源池时切换到'全部'页签
- 修复资源池复制业务拓扑数据失败的问题
- 修复实例筛选出现重复的ID属性的问题
- 修复首页mac os环境下快捷搜索无效的问题
- 修复主机搜索和动态分组主机搜索逻辑中未能正确判定数据是否不存在的bug
- 修复权限中心反向拉取时因为没有设置用户导致查询失败的问题

## [Version: 3.9.7] - 2020-10-13
**新增功能**
- 调整了动态分组功能形态，支持主机、集群等的动态查询能力
- 增加通过集群模版查询服务实例列表的接口
- 添加mongo中的超时时间配置
- 新加支持根据服务名发现服务功能
- 权限中心回调接口支持按名字查询实例

**功能优化**
- 首页mac系统支持command + enter快速搜索
- 补充通过集群模版查询服务实例列表集成测试用例
- 将es在websever和toposerver的配置抽取出来，进行公共配置
- 服务分类名称重复创建后报错提示优化
- 服务模板列表支持部分字段排序
- 空业务列表查看提示语优化
- 主机页允许批量编辑已分配的主机

**缺陷修复**
- 修复获取拓扑节点路径的接口在集群的上一级为业务的时候不设置集群名字的问题
- 修正以host为关联关系原模型时，删除实例操作没有检测到其存在关联关系的问题
- 修复用户传多次相同节点时执行多次反向排序导致查询的拓扑路径顺序错误的问题
- 修复云账户列表默认查询无数据的问题
- 修复主机页面资源池目录不显示的问题

## [Version: 3.9.6] - 2020-09-24
**新增功能**
- 增加查询业务下模块的接口,可跨多个集群查询
- datacollection变更字段可以根据环境配置
- 新增根据集群ID和服务模版ID查询模块的接口
- 权限解析获取资源池业务和默认目录ID支持多开发商
- 增加验证yaml文件工具功能，可以指定文件进行验证
- 添加批量获取新序列号的函数

**功能优化**
- 不指定模糊查询的情况下，查询接口默认使用精确匹配查询
- 对datacollection在采集数据时进行防抖处理优化
- 资源池支持按业务属性筛选主机
- 内置字段允许修改单位及提示,模型关系查看关联关系显示关联类型，服务模板、集群模板列表添加ID列
- 查询拓扑节点路径的接口过滤掉不存在的模块
- 更新项目架构图和代码架构图及其描述
- 移除prometheus metric 采集返回的appCode、realIp、user字段
- 优化服务实例查询性能
- 优化list_hosts_topo 获取全量主机的逻辑
- 运营统计和操作审计相关接口读取数据走从db
- 主机身份，list_hosts_topo 走 mongodb 从节点获取数据
- 将authserver中操作的查询数据方法放到mongodb的从节点中执行
- 将/api/v3/hosts/list_hosts_without_app操作的查询数据方法放到mongodb的从节点中执行
- 查询云区域时不同步查询其下的主机数量，加快页面响应速度

**缺陷修复**
- 修正处理采集器上报数据的逻辑，避免数据回滚问题
- 修复切换拓扑节点时未重置url筛选参数的问题
- 解决服务分类二级服务分类名称重复问题
- 修复权限解析获取资源池时会包含0开发商的问题
- 修复编辑模板进程绑定信息保存无效的问题
- 修复获取默认资源池目录ID错误的问题
- 修复移除metadata导致导入模型字段失败的问题
- 修复有部分模型权限时无法批量更新这些模型的问题
- 修复无变更时模板要求同步的问题
- 修复收藏条件应用无效的问题
- 修复运营统计新增图标UI异常的问题
- 修复新增一级服务分类时中断流程可能引起的UI异常的问题
- 修复当主机没有安装agent时，快照实时页面显示不对的问题

## [Version: 3.9.5] - 2020-09-09
**功能优化**
- 操作审计优化
- 资源池显示主机拓扑路径及支持主机转移模块
- 调整synchronizeserver和cloudserver的健康检查接口
- 查询主机业务关系接口增加对入参bk_host_id的校验
- 调整批量查询主机快照的数量限制为200
- 去除资源池主机、模型实例的新建关联权限
- 主机的 display_name 调整为IP(云区域名)的形式
- 调整查询动态分组鉴权方式

**缺陷修复**
- 修复 fetch_instance_info 仅返回20条数据的问题
- 修复设置蓝鲸拓扑可编辑接口鉴权失败的问题
- 修复权限回调接口查询主机时使用分页缓存查询传递了所有hostID导致返回全部数据的问题

## [Version: 3.9.4] - 2020-08-25
**功能优化**
- 资源池主机显示ID
- 主机收藏跳过鉴权
- 添加业务拓扑等新建操作的关联权限
- 主机转移鉴权使用服务实例增删改权限

**缺陷修复**
- 修复主机详情查询属性参数错误的问题
- 修复云账户编辑后表格数据未同步刷新的问题
- 修复实例表格字段显示设置还原默认时状态未重置的问题
- 修复模型实例无法搜索非实例名字段的问题
- 修复编辑服务模板时未选择二级服务分类可以提交的问题
- 修复在云资源任务中新建资源目录后未刷新权限状态的问题
- 修复模型导出时获取模型信息接口鉴权解析要求业务ID不为0的问题
- 修复主机自动应用包含组织字段导致应用失败的问题

## [Version: 3.9.3] - 2020-08-19
**新增功能**
- 模型增加ishide字段，bk_ishidden字段等于true的模型不在前端界面展示

**功能优化**
- 移除metadata字段相关逻辑和升级db数据，去除老版本业务私有数据对该字段的兼容
- 前端前置鉴权优化

**缺陷修复**
- 修复查询云资源任务权限未传实例ID的问题
- 修复云区域地域请求报错的问题

**缺陷修复**
- 修复导入模型excel存在内置字段而报错的问题
- 修复bk_supplier_id数据类型为字符串的问题

## [Version: 3.9.2] - 2020-08-13
**新增功能**
- 添加set_template事件监听权限

**缺陷修复**
- 修复动态分组对应权限中心视图配置错误的问题
- 修复获取redis和mongo配置产生的异常

## [Version: 3.9.1] - 2020-08-11
**新增功能**
- 对接新版权限中心，与原有v3.8以下权限管理方式不兼容
- 新增云资源管理功能
- 配置文件调整为yaml格式
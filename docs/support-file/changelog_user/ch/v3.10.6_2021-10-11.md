## 【配置平台】v3.10.6 版本更新 - 2021-10-11

## 新增

-  [新增] 新版全文检索升级，请阅读[指引](https://github.com/TencentBlueKing/bk-cmdb/issues/5507)
-  [新增] 业务拓扑调整，需要在升级完该版本后，利用小工具删除缓存数据，具体详情见issue[#5471](https://github.com/TencentBlueKing/bk-cmdb/issues/5471)）
-  [新增] 属性鉴权功能，请注意版本依赖：IAM SaaS` >= 1.4.15`，IAM 后台` >=1.7.7`。该版本涉及存量模型实例权限的迁移，如果权限较多执行init_db进行权限迁移的过程可能会持续一段时间，建议在执行权限迁移过程避免执行权限申请和实例操作。
-  [新增] 新增清理审计日志接口（接口使用方法可参考issue[#5603](https://github.com/TencentBlueKing/bk-cmdb/issues/5603)）
-  [新增] 业务支持跨页批量编辑
-  [新增] 归档业务提供“彻底删除”能力

## 修复

-  [修复] 修复新建实例自关联的关联关系时对该实例获取两次锁导致失败的问题
-  [修复] 修复使用主机/服务实例数量统计接口引起的topo创建问题
-  [修复] 修复资源目录模型实例查询时，查询模式切换混乱的问题
-  [修复] 修复模型关系新建层级时重复点击创建按钮仍然可以创建的问题
-  [修复] 修复模型实例详情错误出现loading的问题
-  [修复] 修复查看单个实例模型删除历史时加载了其他实例删除历史的问题
-  [修复] 修复运营统计页面数据异常导致显示无权限的问题
-  [修复] 修复集群模板同步状态会把同步人设置为当前用户的问题
-  [修复] 修复主线模型事件在redis中找不到详情信息后去db查不到的问题
-  [修复] 修复对于大量主机（主机数量大于500并且服务模板中进程模板数量大于10）转移场景下的panic问题
-  [修复] 处理动态分组，字段类型为组织时的校验问题
-  [修复] 主机数据导出时，如果没有自定义层级时，调整module、set数据的处理
-  [修复] 修复查询主机删除历史bk_obj_id参数问题
-  [修复] 修复模块中添加主机在有模板无进程创建服务实例时出错的问题
-  [修复] 修复运营统计实例图表未显示问题
-  [修复] 修复动态分组编辑和删除的鉴权，列表中只鉴权了第一个的问题
-  [修复] 修复自关联模型拓扑数据展示不全的问题
-  [修复] 修复模块中主机均无服务实例时无法转移到空闲机的问题
-  [修复] 修复未正确获取进程数据导致无法克隆服务实例到其它主机的问题
-  [修复] 修复导入模型属性时错误的将id置为0的问题
-  [修复] 修正主线模型的判断条件，不以业务拓扑分组为判断条件，使该分组下的通用模型能正常同步到IAM
-  [修复] upgrade添加跳过未注册动作的升级操作
-  [修复] 修复审计下无法查询动态分组的问题
-  [修复] 通用模型实例鉴权问题修复
-  [修复] 修复了同步集群模板实例时事务提交失败导致的报错
-  [修复] 主机搜索解决输入 \ 字符搜不到的问题

## 优化

-  [优化] 主机字符字段支持模糊搜索
-  [优化] 查询集群模板同步状态兼容集群下无模块的情况
-  [优化] 业务名称搜索默认支持模糊搜索
-  [优化] taskserver清除一个月之前的冗余任务
-  [优化] 通用模型内置字段名称统一为不可修改
-  [优化] 业务名搜索从大小写敏感改成大小写不敏感
-  [优化] coreservice优化count逻辑
-  [优化] 优化多值过滤项中IP项溢出隐藏文案展示
-  [优化] 修复动态分组条件操作符未显示问题
-  [优化] 修复获取topo节点主机数量接口缺陷
-  [优化] 修复主机属性自动应用的逻辑失效问题
-  [优化] 主机与服务实例解耦优化
-  [优化] 主机和通用模型实例权限申请只显示无权限的实例
-  [优化] 查询有权限的实例列表功能优化
-  [优化] toposerver重构
-  [优化] 修改通用模型名称时，同步模型名到IAM
-  [优化] 业务拓扑缓存调整（注意：需要在升级完该版本后，利用小工具删除缓存数据，具体详情见issue[#5471](https://github.com/TencentBlueKing/bk-cmdb/issues/5471)）
-  [优化] 属性鉴权功能中迁移存量模型实例的权限
-  [优化] 资源导出默认勾选上表头配置的属性列
-  [优化] 全文检索体验优化
-  [优化] 主机导出时，默认将业务、自定义层级、集群、模块各放一列导出， 方便用户对这3个模型进行筛选
-  [优化] 导出实例数据时、通过并发获取用户数据，提高性能
-  [优化] 主机身份事件监听在watch token里添加id和cursor信息，防止用户用过期的最后一个cursor请求时报错
-  [优化] “业务” 支持批量编辑合入v3.10.x后的代码优化
-  [优化] 将服务实例下进程的唯一校验规则放到唯一索引中处理
-  [优化] 无权限时直接返回空不能提示错误
-  [优化] 调整代码逻辑以兼容没有任何内置自定义对象的场景